<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clien»õi - Atelier T√¢mplƒÉrie</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <div class="container">
            <h1>üî® Atelier T√¢mplƒÉrie</h1>
        </div>
    </header>

    <nav>
        <ul>
            <li><a href="index.html">üìä Dashboard</a></li>
            <li><a href="clienti.html" class="active">üë• Clien»õi</a></li>
            <li><a href="proiecte.html">üìÅ Proiecte</a></li>
            <li><a href="stoc.html">üì¶ Stoc</a></li>
        </ul>
    </nav>

    <div class="container">
        <div class="content-section">
            <div class="section-header">
                <h2>üë• Gestionare Clien»õi</h2>
                <button class="btn btn-primary" onclick="openAddModal()">‚ûï AdaugƒÉ Client</button>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Nume</th>
                            <th>Telefon</th>
                            <th>Email</th>
                            <th>AdresƒÉ</th>
                            <th>Nr. Proiecte</th>
                            <th>Ac»õiuni</th>
                        </tr>
                    </thead>
                    <tbody id="clienti-tbody">
                        <tr>
                            <td colspan="6" class="text-center">Se √ÆncarcƒÉ...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal AdaugƒÉ/EditeazƒÉ Client -->
    <div id="clientModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">AdaugƒÉ Client Nou</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            
            <form id="clientForm" onsubmit="saveClient(event)">
                <input type="hidden" id="client-id">
                
                <div class="form-group">
                    <label for="nume">Nume *</label>
                    <input type="text" id="nume" required placeholder="Ex: Popescu Ion">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="telefon">Telefon</label>
                        <input type="tel" id="telefon" placeholder="Ex: 0722123456">
                    </div>

                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" placeholder="Ex: popescu@email.com">
                    </div>
                </div>

                <div class="form-group">
                    <label for="adresa">AdresƒÉ</label>
                    <textarea id="adresa" placeholder="Ex: Str. PrincipalƒÉ nr. 10, Bucure»ôti"></textarea>
                </div>

                <div class="form-group">
                    <label for="observatii">Observa»õii</label>
                    <textarea id="observatii" placeholder="Note despre client, preferin»õe, etc."></textarea>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">AnuleazƒÉ</button>
                    <button type="submit" class="btn btn-success">üíæ SalveazƒÉ</button>
                </div>
            </form>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script>
        let currentClientId = null;

        // √éncarcƒÉ clien»õii
        async function loadClienti() {
            try {
                const clienti = await API.getClienti();
                displayClienti(clienti);
            } catch (error) {
                showError('Eroare la √ÆncƒÉrcarea clien»õilor');
            }
        }

        function displayClienti(clienti) {
            const tbody = document.getElementById('clienti-tbody');
            
            if (!clienti || clienti.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6">
                            <div class="empty-state">
                                <div class="empty-state-icon">üë•</div>
                                <h3>Nu existƒÉ clien»õi</h3>
                                <p>AdaugƒÉ primul client pentru a √Æncepe</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = clienti.map(c => `
                <tr onclick="window.location.href='client-detalii.html?id=${c.id}'" style="cursor: pointer;">
                    <td><strong>${c.nume}</strong></td>
                    <td>${c.telefon || '-'}</td>
                    <td>${c.email || '-'}</td>
                    <td>${c.adresa || '-'}</td>
                    <td>${c.numarProiecte || 0}</td>
                    <td onclick="event.stopPropagation()">
                        <button class="btn btn-sm btn-primary" onclick="event.stopPropagation(); window.location.href='client-detalii.html?id=${c.id}'">üëÅÔ∏è Vezi</button>
                        <button class="btn btn-sm btn-primary" onclick="event.stopPropagation(); editClient(${c.id})">‚úèÔ∏è EditeazƒÉ</button>
                        <button class="btn btn-sm btn-danger" onclick="event.stopPropagation(); deleteClient(${c.id}, '${c.nume}')">üóëÔ∏è »òterge</button>
                    </td>
                </tr>
            `).join('');
        }

        function openAddModal() {
            currentClientId = null;
            document.getElementById('modal-title').textContent = 'AdaugƒÉ Client Nou';
            document.getElementById('clientForm').reset();
            document.getElementById('client-id').value = '';
            document.getElementById('clientModal').classList.add('active');
        }

        async function editClient(id) {
            try {
                const client = await API.getClient(id);
                currentClientId = id;
                
                document.getElementById('modal-title').textContent = 'EditeazƒÉ Client';
                document.getElementById('client-id').value = client.id;
                document.getElementById('nume').value = client.nume;
                document.getElementById('telefon').value = client.telefon || '';
                document.getElementById('email').value = client.email || '';
                document.getElementById('adresa').value = client.adresa || '';
                document.getElementById('observatii').value = client.observatii || '';
                
                document.getElementById('clientModal').classList.add('active');
            } catch (error) {
                showError('Eroare la √ÆncƒÉrcarea datelor clientului');
            }
        }

        async function saveClient(event) {
            event.preventDefault();
            
            const clientData = {
                id: currentClientId || 0,
                nume: document.getElementById('nume').value,
                telefon: document.getElementById('telefon').value || null,
                email: document.getElementById('email').value || null,
                adresa: document.getElementById('adresa').value || null,
                observatii: document.getElementById('observatii').value || null
            };

            try {
                if (currentClientId) {
                    await API.updateClient(currentClientId, clientData);
                    showSuccess('Client actualizat cu succes!');
                } else {
                    await API.createClient(clientData);
                    showSuccess('Client adƒÉugat cu succes!');
                }
                
                closeModal();
                loadClienti();
            } catch (error) {
                showError('Eroare la salvarea clientului');
            }
        }

        async function deleteClient(id, nume) {
            if (confirmDelete(nume)) {
                try {
                    await API.deleteClient(id);
                    showSuccess('Client »ôters cu succes!');
                    loadClienti();
                } catch (error) {
                    showError('Eroare la »ôtergerea clientului');
                }
            }
        }

        function closeModal() {
            document.getElementById('clientModal').classList.remove('active');
        }

        // Click √Æn afara modalului pentru √Ænchidere
        window.onclick = function(event) {
            const modal = document.getElementById('clientModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // √éncarcƒÉ clien»õii la pornire
        loadClienti();
    </script>
</body>
</html>