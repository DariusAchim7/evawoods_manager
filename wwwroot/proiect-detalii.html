<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalii Proiect - Atelier TÃ¢mplÄƒrie</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <div class="container">
            <h1>ğŸ”¨ Atelier TÃ¢mplÄƒrie</h1>
        </div>
    </header>

    <nav>
        <ul>
            <li><a href="index.html">ğŸ“Š Dashboard</a></li>
            <li><a href="clienti.html">ğŸ‘¥ ClienÈ›i</a></li>
            <li><a href="proiecte.html">ğŸ“ Proiecte</a></li>
            <li><a href="stoc.html">ğŸ“¦ Stoc</a></li>
        </ul>
    </nav>

    <div class="container">
        <!-- Header Proiect -->
        <div class="content-section">
            <div class="section-header">
                <div>
                    <a href="#" id="back-link" class="btn btn-secondary">â† Ãnapoi</a>
                </div>
                <div>
                    <button class="btn btn-primary" onclick="editProiect()">âœï¸ EditeazÄƒ Proiect</button>
                    <button class="btn btn-danger" onclick="deleteProiect()">ğŸ—‘ï¸ È˜terge Proiect</button>
                </div>
            </div>

            <!-- Card Proiect -->
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 8px; margin-bottom: 30px;">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 20px;">
                    <div>
                        <h2 style="color: white; margin-bottom: 10px;" id="proiect-nume">...</h2>
                        <p style="margin: 0; opacity: 0.9;">
                            <strong>Client:</strong> <span id="proiect-client">...</span>
                        </p>
                    </div>
                    <div id="proiect-status-badge"></div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div>
                        <strong>ğŸ“… Data Start:</strong><br>
                        <span id="proiect-data-start">-</span>
                    </div>
                    <div>
                        <strong>ğŸ“… Data Finalizare:</strong><br>
                        <span id="proiect-data-finalizare">-</span>
                    </div>
                    <div>
                        <strong>ğŸ’° PreÈ› Estimat:</strong><br>
                        <span id="proiect-pret-estimat" style="font-size: 1.2em;">-</span>
                    </div>
                    <div>
                        <strong>ğŸ’µ PreÈ› Final:</strong><br>
                        <span id="proiect-pret-final" style="font-size: 1.2em;">-</span>
                    </div>
                </div>

                <div style="margin-top: 20px;" id="proiect-descriere-container">
                    <strong>ğŸ“ Descriere:</strong><br>
                    <span id="proiect-descriere">-</span>
                </div>
            </div>
        </div>

        <!-- Statistici Financiare -->
        <div class="stats-grid">
            <div class="stat-card info">
                <h3>ğŸ’° Ãncasat</h3>
                <div class="value" id="stat-incasat">0 RON</div>
                <div class="label">PreÈ› estimat/final</div>
            </div>
            <div class="stat-card danger">
                <h3>ğŸ’¸ Cheltuieli</h3>
                <div class="value" id="stat-cheltuieli">0 RON</div>
                <div class="label">Total costuri</div>
            </div>
            <div class="stat-card success">
                <h3>ğŸ“ˆ Profit</h3>
                <div class="value" id="stat-profit">0 RON</div>
                <div class="label">Ãncasat - Cheltuieli</div>
            </div>
            <div class="stat-card warning">
                <h3>ğŸ“Š MarjÄƒ</h3>
                <div class="value" id="stat-marja">0%</div>
                <div class="label">Procent profit</div>
            </div>
        </div>

        <!-- Cheltuieli -->
        <div class="content-section">
            <div class="section-header">
                <h2>ğŸ’° Cheltuieli Proiect</h2>
                <button class="btn btn-primary" onclick="openAddCheltuialaModal()">â• AdaugÄƒ CheltuialÄƒ</button>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Tip</th>
                            <th>Descriere</th>
                            <th>SumÄƒ</th>
                            <th>AcÈ›iuni</th>
                        </tr>
                    </thead>
                    <tbody id="cheltuieli-tbody">
                        <tr>
                            <td colspan="5" class="text-center">Se Ã®ncarcÄƒ...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Breakdown Cheltuieli pe Tip -->
            <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px;" id="breakdown-container">
                <h3 style="margin-bottom: 15px;">ğŸ“Š Breakdown Cheltuieli</h3>
                <div id="breakdown-content"></div>
            </div>
        </div>
    </div>

    <!-- Modal EditeazÄƒ Proiect -->
    <div id="proiectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>EditeazÄƒ Proiect</h3>
                <button class="close-btn" onclick="closeProiectModal()">&times;</button>
            </div>
            
            <form id="proiectForm" onsubmit="saveProiect(event)">
                <div class="form-group">
                    <label for="nume-proiect">Nume Proiect *</label>
                    <input type="text" id="nume-proiect" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="status">Status *</label>
                        <select id="status" required>
                            <option value="planificat">Planificat</option>
                            <option value="in_lucru">Ãn lucru</option>
                            <option value="finalizat">Finalizat</option>
                            <option value="anulat">Anulat</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="pret-estimat">PreÈ› Estimat (RON)</label>
                        <input type="number" id="pret-estimat" step="0.01">
                    </div>
                </div>

                <div class="form-group">
                    <label for="pret-final">PreÈ› Final (RON)</label>
                    <input type="number" id="pret-final" step="0.01">
                </div>

                <div class="form-group">
                    <label for="descriere">Descriere</label>
                    <textarea id="descriere"></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="data-start">Data Start</label>
                        <input type="date" id="data-start">
                    </div>
                    <div class="form-group">
                        <label for="data-finalizare">Data Finalizare</label>
                        <input type="date" id="data-finalizare">
                    </div>
                </div>

                <div class="form-group">
                    <label for="observatii">ObservaÈ›ii</label>
                    <textarea id="observatii"></textarea>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeProiectModal()">AnuleazÄƒ</button>
                    <button type="submit" class="btn btn-success">ğŸ’¾ SalveazÄƒ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal AdaugÄƒ/EditeazÄƒ CheltuialÄƒ -->
    <div id="cheltuialaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="cheltuiala-modal-title">AdaugÄƒ CheltuialÄƒ</h3>
                <button class="close-btn" onclick="closeCheltuialaModal()">&times;</button>
            </div>
            
            <form id="cheltuialaForm" onsubmit="saveCheltuiala(event)">
                <input type="hidden" id="cheltuiala-id">

                <div class="form-row">
                    <div class="form-group">
                        <label for="tip-cheltuiala">Tip CheltuialÄƒ *</label>
                        <select id="tip-cheltuiala" required onchange="toggleMaterialCategories()">
                            <option value="materiale">Materiale</option>
                            <option value="manopera">ManoperÄƒ</option>
                            <option value="transport">Transport</option>
                            <option value="altele">Altele</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="suma">SumÄƒ (RON) *</label>
                        <input type="number" id="suma" step="0.01" required>
                    </div>
                </div>

                <!-- Categorii materiale (vizibil doar pentru tip "materiale") -->
                <div id="material-categories-section" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="categorie-material">Categorie Material</label>
                            <select id="categorie-material" onchange="updateSubcategories()">
                                <option value="">SelecteazÄƒ categorie...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="subcategorie-material">Subcategorie</label>
                            <select id="subcategorie-material">
                                <option value="">SelecteazÄƒ subcategorie...</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="cantitate">Cantitate</label>
                            <input type="number" id="cantitate" step="0.01" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label for="unitate-masura">Unitate MÄƒsurÄƒ</label>
                            <select id="unitate-masura">
                                <option value="">SelecteazÄƒ...</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="descriere-cheltuiala">Descriere *</label>
                    <input type="text" id="descriere-cheltuiala" required placeholder="Ex: Lemn stejar pentru blat">
                </div>

                <div class="form-group">
                    <label for="data-cheltuiala">Data CheltuialÄƒ</label>
                    <input type="date" id="data-cheltuiala">
                </div>

                <div class="form-group">
                    <label for="observatii-cheltuiala">ObservaÈ›ii</label>
                    <textarea id="observatii-cheltuiala"></textarea>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeCheltuialaModal()">AnuleazÄƒ</button>
                    <button type="submit" class="btn btn-success">ğŸ’¾ SalveazÄƒ</button>
                </div>
            </form>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script src="js/material-categories.js"></script>
    <script>
        let proiectId = null;
        let currentProiect = null;
        let currentCheltuialaId = null;

        // IniÈ›ializare categorii materiale la Ã®ncÄƒrcarea paginii
        function initializeMaterialCategories() {
            // PopuleazÄƒ dropdown categorii
            const categorieSelect = document.getElementById('categorie-material');
            const categories = getMaterialCategories();
            categorieSelect.innerHTML = '<option value="">SelecteazÄƒ categorie...</option>';
            categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                categorieSelect.appendChild(option);
            });

            // PopuleazÄƒ dropdown unitÄƒÈ›i de mÄƒsurÄƒ
            const unitateSelect = document.getElementById('unitate-masura');
            unitateSelect.innerHTML = '<option value="">SelecteazÄƒ...</option>';
            UNITATI_MASURA.forEach(unit => {
                const option = document.createElement('option');
                option.value = unit.value;
                option.textContent = unit.label;
                unitateSelect.appendChild(option);
            });
        }

        // ActualizeazÄƒ subcategoriile cÃ¢nd se schimbÄƒ categoria
        function updateSubcategories() {
            const categorieSelect = document.getElementById('categorie-material');
            const subcategorieSelect = document.getElementById('subcategorie-material');
            const unitateSelect = document.getElementById('unitate-masura');
            
            const selectedCategory = categorieSelect.value;
            
            if (selectedCategory) {
                const subcategories = getSubcategories(selectedCategory);
                subcategorieSelect.innerHTML = '<option value="">SelecteazÄƒ subcategorie...</option>';
                subcategories.forEach(subcat => {
                    const option = document.createElement('option');
                    option.value = subcat;
                    option.textContent = subcat;
                    subcategorieSelect.appendChild(option);
                });

                // SeteazÄƒ unitatea implicitÄƒ
                const defaultUnit = getDefaultUnit(selectedCategory);
                unitateSelect.value = defaultUnit;
            } else {
                subcategorieSelect.innerHTML = '<option value="">SelecteazÄƒ subcategorie...</option>';
            }
        }

        // AratÄƒ/ascunde secÈ›iunea de categorii materiale
        function toggleMaterialCategories() {
            const tipCheltuiala = document.getElementById('tip-cheltuiala').value;
            const materialSection = document.getElementById('material-categories-section');
            
            if (tipCheltuiala === 'materiale') {
                materialSection.style.display = 'block';
            } else {
                materialSection.style.display = 'none';
                // Reset cÃ¢mpurile
                document.getElementById('categorie-material').value = '';
                document.getElementById('subcategorie-material').value = '';
                document.getElementById('cantitate').value = '';
                document.getElementById('unitate-masura').value = '';
            }
        }

        function getProiectIdFromUrl() {
            const params = new URLSearchParams(window.location.search);
            return parseInt(params.get('id'));
        }

        async function loadProiectData() {
            proiectId = getProiectIdFromUrl();
            
            if (!proiectId) {
                showError('ID proiect invalid');
                setTimeout(() => window.location.href = 'proiecte.html', 2000);
                return;
            }

            try {
                currentProiect = await API.getProiect(proiectId);
                displayProiectInfo(currentProiect);
                
                const cheltuieliData = await API.getCheltuieliByProiect(proiectId);
                displayCheltuieli(cheltuieliData.cheltuieli || []);
                displayBreakdown(cheltuieliData.cheltuieliPeTip || []);
                calculateStatistics(currentProiect, cheltuieliData.totalCheltuieli || 0);

                // SeteazÄƒ link-ul Ã®napoi
                document.getElementById('back-link').href = `client-detalii.html?id=${currentProiect.clientId}`;
            } catch (error) {
                showError('Eroare la Ã®ncÄƒrcarea datelor proiectului');
                console.error(error);
            }
        }

        function displayProiectInfo(proiect) {
            document.getElementById('proiect-nume').textContent = proiect.numeProiect;
            document.getElementById('proiect-client').textContent = proiect.clientNume;
            
            const statusBadge = getStatusBadge(proiect.status);
            document.getElementById('proiect-status-badge').innerHTML = statusBadge;
            
            document.getElementById('proiect-data-start').textContent = formatDate(proiect.dataStart);
            document.getElementById('proiect-data-finalizare').textContent = formatDate(proiect.dataFinalizare);
            document.getElementById('proiect-pret-estimat').textContent = formatCurrency(proiect.pretEstimat);
            document.getElementById('proiect-pret-final').textContent = formatCurrency(proiect.pretFinal);
            
            const descriereContainer = document.getElementById('proiect-descriere-container');
            if (proiect.descriere) {
                document.getElementById('proiect-descriere').textContent = proiect.descriere;
                descriereContainer.style.display = 'block';
            } else {
                descriereContainer.style.display = 'none';
            }

            document.title = `${proiect.numeProiect} - Atelier TÃ¢mplÄƒrie`;
        }

        function calculateStatistics(proiect, totalCheltuieli) {
            const incasat = proiect.pretFinal || proiect.pretEstimat || 0;
            const cheltuieli = totalCheltuieli;
            const profit = incasat - cheltuieli;
            const marja = incasat > 0 ? ((profit / incasat) * 100).toFixed(1) : 0;

            document.getElementById('stat-incasat').textContent = formatCurrency(incasat);
            document.getElementById('stat-cheltuieli').textContent = formatCurrency(cheltuieli);
            document.getElementById('stat-profit').textContent = formatCurrency(profit);
            document.getElementById('stat-marja').textContent = marja + '%';

            // SchimbÄƒ culoarea profitului
            const profitCard = document.getElementById('stat-profit').closest('.stat-card');
            if (profit < 0) {
                profitCard.classList.remove('success');
                profitCard.classList.add('danger');
            } else {
                profitCard.classList.remove('danger');
                profitCard.classList.add('success');
            }
        }

        function displayCheltuieli(cheltuieli) {
            const tbody = document.getElementById('cheltuieli-tbody');
            
            if (!cheltuieli || cheltuieli.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5">
                            <div class="empty-state">
                                <div class="empty-state-icon">ğŸ’°</div>
                                <h3>Nu existÄƒ cheltuieli pentru acest proiect</h3>
                                <p>AdaugÄƒ prima cheltuialÄƒ pentru a Ã®ncepe</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = cheltuieli.map(ch => {
                let descriereCompleta = ch.descriere;
                
                // AdaugÄƒ categoria È™i subcategoria dacÄƒ existÄƒ
                if (ch.categorieMaterial) {
                    descriereCompleta += ` <span class="badge badge-info" style="font-size: 11px;">${ch.categorieMaterial}</span>`;
                    if (ch.subcategorieMaterial) {
                        descriereCompleta += ` <span class="badge" style="font-size: 11px; background: #6c757d; color: white;">${ch.subcategorieMaterial}</span>`;
                    }
                }
                
                // AdaugÄƒ cantitatea dacÄƒ existÄƒ
                if (ch.cantitate) {
                    descriereCompleta += ` <br><small style="color: #666;">Cantitate: ${formatNumber(ch.cantitate)} ${ch.unitateMasura || ''}</small>`;
                }
                
                return `
                <tr>
                    <td>${formatDate(ch.dataCheltuiala)}</td>
                    <td><span class="badge badge-info">${ch.tipCheltuiala}</span></td>
                    <td>${descriereCompleta}</td>
                    <td><strong>${formatCurrency(ch.suma)}</strong></td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="editCheltuiala(${ch.id})">âœï¸</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteCheltuiala(${ch.id}, '${ch.descriere}')">ğŸ—‘ï¸</button>
                    </td>
                </tr>
            `}).join('');
        }

        function displayBreakdown(cheltuieliPeTip) {
            const container = document.getElementById('breakdown-content');
            
            if (!cheltuieliPeTip || cheltuieliPeTip.length === 0) {
                container.innerHTML = '<p style="color: #999;">Nu existÄƒ cheltuieli</p>';
                return;
            }

            const total = cheltuieliPeTip.reduce((sum, item) => sum + item.total, 0);
            
            container.innerHTML = cheltuieliPeTip.map(item => {
                const procent = total > 0 ? ((item.total / total) * 100).toFixed(1) : 0;
                return `
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <strong>${item.tipCheltuiala}</strong>
                            <span>${formatCurrency(item.total)} (${procent}%)</span>
                        </div>
                        <div style="background: #ddd; height: 10px; border-radius: 5px; overflow: hidden;">
                            <div style="background: var(--secondary-color); width: ${procent}%; height: 100%;"></div>
                        </div>
                        <small style="color: #666;">${item.numar} cheltuieli</small>
                    </div>
                `;
            }).join('');
        }

        function editProiect() {
            document.getElementById('nume-proiect').value = currentProiect.numeProiect;
            document.getElementById('status').value = currentProiect.status;
            document.getElementById('pret-estimat').value = currentProiect.pretEstimat || '';
            document.getElementById('pret-final').value = currentProiect.pretFinal || '';
            document.getElementById('descriere').value = currentProiect.descriere || '';
            document.getElementById('data-start').value = currentProiect.dataStart ? currentProiect.dataStart.split('T')[0] : '';
            document.getElementById('data-finalizare').value = currentProiect.dataFinalizare ? currentProiect.dataFinalizare.split('T')[0] : '';
            document.getElementById('observatii').value = currentProiect.observatii || '';
            document.getElementById('proiectModal').classList.add('active');
        }

        async function saveProiect(event) {
            event.preventDefault();
            
            const proiectData = {
                numeProiect: document.getElementById('nume-proiect').value,
                clientId: currentProiect.clientId,
                status: document.getElementById('status').value,
                descriere: document.getElementById('descriere').value || null,
                pretEstimat: parseFloat(document.getElementById('pret-estimat').value) || null,
                pretFinal: parseFloat(document.getElementById('pret-final').value) || null,
                dataStart: document.getElementById('data-start').value || null,
                dataFinalizare: document.getElementById('data-finalizare').value || null,
                observatii: document.getElementById('observatii').value || null
            };

            try {
                await API.updateProiect(proiectId, proiectData);
                showSuccess('Proiect actualizat cu succes!');
                closeProiectModal();
                loadProiectData();
            } catch (error) {
                showError('Eroare la actualizarea proiectului');
            }
        }

        async function deleteProiect() {
            if (confirmDelete(currentProiect.numeProiect)) {
                try {
                    await API.deleteProiect(proiectId);
                    showSuccess('Proiect È™ters cu succes!');
                    setTimeout(() => window.location.href = `client-detalii.html?id=${currentProiect.clientId}`, 1500);
                } catch (error) {
                    showError('Eroare la È™tergerea proiectului');
                }
            }
        }

        function openAddCheltuialaModal() {
            currentCheltuialaId = null;
            document.getElementById('cheltuiala-modal-title').textContent = 'AdaugÄƒ CheltuialÄƒ';
            document.getElementById('cheltuialaForm').reset();
            document.getElementById('cheltuiala-id').value = '';
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('data-cheltuiala').value = today;
            
            // IniÈ›ializeazÄƒ categoriile
            initializeMaterialCategories();
            toggleMaterialCategories();
            
            document.getElementById('cheltuialaModal').classList.add('active');
        }

        async function editCheltuiala(id) {
            try {
                const cheltuiala = await API.getCheltuiala(id);
                currentCheltuialaId = id;
                
                document.getElementById('cheltuiala-modal-title').textContent = 'EditeazÄƒ CheltuialÄƒ';
                document.getElementById('cheltuiala-id').value = cheltuiala.id;
                document.getElementById('tip-cheltuiala').value = cheltuiala.tipCheltuiala;
                document.getElementById('suma').value = cheltuiala.suma;
                document.getElementById('descriere-cheltuiala').value = cheltuiala.descriere;
                document.getElementById('data-cheltuiala').value = cheltuiala.dataCheltuiala ? cheltuiala.dataCheltuiala.split('T')[0] : '';
                document.getElementById('observatii-cheltuiala').value = cheltuiala.observatii || '';
                
                // IniÈ›ializeazÄƒ categoriile
                initializeMaterialCategories();
                toggleMaterialCategories();
                
                // PopuleazÄƒ cÃ¢mpurile materiale dacÄƒ existÄƒ
                if (cheltuiala.categorieMaterial) {
                    document.getElementById('categorie-material').value = cheltuiala.categorieMaterial;
                    updateSubcategories();
                    if (cheltuiala.subcategorieMaterial) {
                        document.getElementById('subcategorie-material').value = cheltuiala.subcategorieMaterial;
                    }
                }
                if (cheltuiala.cantitate) {
                    document.getElementById('cantitate').value = cheltuiala.cantitate;
                }
                if (cheltuiala.unitateMasura) {
                    document.getElementById('unitate-masura').value = cheltuiala.unitateMasura;
                }
                
                document.getElementById('cheltuialaModal').classList.add('active');
            } catch (error) {
                showError('Eroare la Ã®ncÄƒrcarea cheltuielii');
            }
        }

        async function saveCheltuiala(event) {
            event.preventDefault();
            
            const tipCheltuiala = document.getElementById('tip-cheltuiala').value;
            
            const cheltuialaData = {
                proiectId: proiectId,
                tipCheltuiala: tipCheltuiala,
                descriere: document.getElementById('descriere-cheltuiala').value,
                suma: parseFloat(document.getElementById('suma').value),
                dataCheltuiala: document.getElementById('data-cheltuiala').value || null,
                observatii: document.getElementById('observatii-cheltuiala').value || null,
                categorieMaterial: tipCheltuiala === 'materiale' ? (document.getElementById('categorie-material').value || null) : null,
                subcategorieMaterial: tipCheltuiala === 'materiale' ? (document.getElementById('subcategorie-material').value || null) : null,
                cantitate: tipCheltuiala === 'materiale' ? (parseFloat(document.getElementById('cantitate').value) || null) : null,
                unitateMasura: tipCheltuiala === 'materiale' ? (document.getElementById('unitate-masura').value || null) : null
            };

            try {
                if (currentCheltuialaId) {
                    await API.updateCheltuiala(currentCheltuialaId, cheltuialaData);
                    showSuccess('CheltuialÄƒ actualizatÄƒ cu succes!');
                } else {
                    await API.createCheltuiala(cheltuialaData);
                    showSuccess('CheltuialÄƒ adÄƒugatÄƒ cu succes!');
                }
                
                closeCheltuialaModal();
                loadProiectData();
            } catch (error) {
                showError('Eroare la salvarea cheltuielii');
            }
        }

        async function deleteCheltuiala(id, descriere) {
            if (confirmDelete(descriere)) {
                try {
                    await API.deleteCheltuiala(id);
                    showSuccess('CheltuialÄƒ È™tearsÄƒ cu succes!');
                    loadProiectData();
                } catch (error) {
                    showError('Eroare la È™tergerea cheltuielii');
                }
            }
        }

        function closeProiectModal() {
            document.getElementById('proiectModal').classList.remove('active');
        }

        function closeCheltuialaModal() {
            document.getElementById('cheltuialaModal').classList.remove('active');
        }

        window.onclick = function(event) {
            if (event.target === document.getElementById('proiectModal')) {
                closeProiectModal();
            }
            if (event.target === document.getElementById('cheltuialaModal')) {
                closeCheltuialaModal();
            }
        }

        loadProiectData();
    </script>
</body>
</html>